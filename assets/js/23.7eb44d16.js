(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{229:function(t,a,e){"use strict";e.r(a);var r=e(2),s=Object(r.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"🤖如何写一个github-app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🤖如何写一个github-app","aria-hidden":"true"}},[t._v("#")]),t._v(" 🤖如何写一个Github App")]),t._v(" "),e("h2",{attrs:{id:"温馨提示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#温馨提示","aria-hidden":"true"}},[t._v("#")]),t._v(" 温馨提示")]),t._v(" "),e("p",[t._v("在继续正文前，先澄清一下：")]),t._v(" "),e("ol",[e("li",[t._v("Github App 是需要部署的，Github 并没有提供托管服务。")]),t._v(" "),e("li",[t._v("在 Github Marketplace 上架并非使用 Github App 的必要条件。也即，没有在上面展示，你一样可以安装使用自己的 Github App。")])]),t._v(" "),e("h2",{attrs:{id:"快速开始"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#快速开始","aria-hidden":"true"}},[t._v("#")]),t._v(" 快速开始")]),t._v(" "),e("ol",[e("li",[t._v("npx create-probot-app your-app")]),t._v(" "),e("li",[t._v("cd your-app")]),t._v(" "),e("li",[t._v("yarn")]),t._v(" "),e("li",[t._v("yarn dev")]),t._v(" "),e("li",[t._v("register a Github App")]),t._v(" "),e("li",[t._v("install the Github App")])]),t._v(" "),e("p",[t._v("实际开发并已上架的App，用于给 pull request 自动打标签："),e("a",{attrs:{href:"https://github.com/marketplace/auto-add-label",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/marketplace/auto-add-label"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("开源地址："),e("a",{attrs:{href:"https://github.com/levy9527/auto-add-label",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/levy9527/auto-add-label"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"安装应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装应用","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装应用")]),t._v(" "),e("p",[t._v("进入 "),e("a",{attrs:{href:"https://github.com/settings/apps",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/settings/apps"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:"https://user-images.githubusercontent.com/9384365/63631087-fb77dd80-c654-11e9-9ffd-bdd776f15af6.png",alt:"image"}})]),t._v(" "),e("p",[t._v("点击安装")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://user-images.githubusercontent.com/9384365/63631075-e0a56900-c654-11e9-8395-3e4fda6b1ee1.png",alt:"image"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://user-images.githubusercontent.com/9384365/63631094-07639f80-c655-11e9-9545-bababf311129.png",alt:"image"}})]),t._v(" "),e("h2",{attrs:{id:"修改权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改权限","aria-hidden":"true"}},[t._v("#")]),t._v(" 修改权限")]),t._v(" "),e("p",[t._v("进入"),e("a",{attrs:{href:"https://github.com/settings/apps",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/settings/apps"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:"https://user-images.githubusercontent.com/9384365/63631100-23674100-c655-11e9-8250-92195a0c0eb3.png",alt:"image"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbpfffxfj318u0bcmzg.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("别忘了，检查下是否订阅了相关事件\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbrc2ox5j31620q479d.jpg",alt:"image.png"}}),t._v("\n如果在初始化后，并且已经有用户(比如自己)安装了 Github App，再更改权限，则需重新获得用户的授权")]),t._v(" "),e("p",[t._v("重新授权入口如下\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbrnsvrnj31j60di40u.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("进入后会有提示\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbs0ocn5j317w0i80va.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("重新授权\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbshnm2lj30xu0u077s.jpg",alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"webhooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webhooks","aria-hidden":"true"}},[t._v("#")]),t._v(" webhooks")]),t._v(" "),e("p",[t._v("可以在 Github App 的 Advanced 页面中查看 webhooks 接收情况\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbsr62cjj31oe0om0xx.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("当然也可以使用 "),e("a",{attrs:{href:"https://smee.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://smee.io"),e("OutboundLink")],1),t._v(" 查看\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbsxqy08j311q0u0gpn.jpg",alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"异常"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#异常","aria-hidden":"true"}},[t._v("#")]),t._v(" 异常")]),t._v(" "),e("h3",{attrs:{id:"_400"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_400","aria-hidden":"true"}},[t._v("#")]),t._v(" 400")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbt74iw1j313a07amyy.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("打开项目根目录下的 "),e("code",[t._v(".env")]),t._v(" ，复制 "),e("code",[t._v("WEBHOOK_SECRET")]),t._v(" 的值")]),t._v(" "),e("p",[t._v("进入 Github App 设置页\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbtgm6tbj311g0bewfx.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("修改 Webhook secret 后保存\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbtt0jo2j30zy0g6q53.jpg",alt:"image.png"}})]),t._v(" "),e("p",[t._v("根据经验，每次修改 Webhook 时，最好同时再编辑一次 Webhook secret（即使值没有发生变化），以避免以上情况的发生。\n"),e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/006y8mN6gy1g6mbu1ucz7j30u608s0tm.jpg",alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),e("p",[t._v("推荐使用 Heroku:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://devcenter.heroku.com/articles/heroku-cli#download-and-install",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 Heroku CLI"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://probot.github.io/docs/deployment/#heroku",target:"_blank",rel:"noopener noreferrer"}},[t._v("部署指南"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("需要指出的一点是，使用 Heroku 时网络体验稍差，不知道是否是我的网络问题，表现在两个方面：")]),t._v(" "),e("ol",[e("li",[t._v("我的翻墙工具需要切换为 蓝灯，否则 Heroku Dashboard 几乎无法打开")]),t._v(" "),e("li",[t._v("在 iTerm2 里使用 Heroku CLI 命令时，很容易出现报错 "),e("code",[t._v("ENOTFOUND: getaddrinfo ENOTFOUND api.heroku.com api.heroku.com:443")]),t._v(" ，需要多次尝试，靠运气成功")])]),t._v(" "),e("p",[t._v("可以放心的是，部署后的应用本身，是很稳定的。")]),t._v(" "),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://probot.github.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://probot.github.io/docs/"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developer.github.com/webhooks/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.github.com/webhooks/"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.blog/2011-10-19-all-of-the-hooks/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.blog/2011-10-19-all-of-the-hooks/"),e("OutboundLink")],1)])])])},[],!1,null,null,null);a.default=s.exports}}]);