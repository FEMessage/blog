(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{224:function(a,s,e){"use strict";e.r(s);var t=e(2),r=Object(t.a)({},function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"🐳从零开始docker化node-js应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#🐳从零开始docker化node-js应用","aria-hidden":"true"}},[a._v("#")]),a._v(" 🐳从零开始Docker化Node.js应用")]),a._v(" "),e("h2",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景","aria-hidden":"true"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),e("p",[a._v("给你一台新买的服务器(CentOS)，相关账户及密码，一个基于Node.js开发的web应用源码包(zip)，要求你在新机器上使用Docker的方式把应用部署起来。此时的你，并没有搞清楚什么是容器/镜像，也没记住几个相关的Linux命令，该怎么办？本文将帮助你摆脱困境")]),a._v(" "),e("h2",{attrs:{id:"方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方案","aria-hidden":"true"}},[a._v("#")]),a._v(" 方案")]),a._v(" "),e("h3",{attrs:{id:"流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#流程","aria-hidden":"true"}},[a._v("#")]),a._v(" 流程")]),a._v(" "),e("p",[a._v("为达到最终目的，先来梳理一波流程：")]),a._v(" "),e("ol",[e("li",[a._v("把源码zip包上传至服务器")]),a._v(" "),e("li",[a._v("登录服务器")]),a._v(" "),e("li",[a._v("解压zip包")]),a._v(" "),e("li",[a._v("安装最新Docker")]),a._v(" "),e("li",[a._v("设置国内镜像加速器")]),a._v(" "),e("li",[a._v("编写Dockerfile")]),a._v(" "),e("li",[a._v("构建镜像")]),a._v(" "),e("li",[a._v("编写启动容器脚本")]),a._v(" "),e("li",[a._v("执行脚本，检查部署情况")])]),a._v(" "),e("p",[a._v("下面将详细描述如何操作")]),a._v(" "),e("blockquote",[e("p",[a._v("文中服务器操作系统为CentOS 7，如果你的服务器不相符，操作细节可能会略有不同，需要另行查阅相关资料")])]),a._v(" "),e("h3",{attrs:{id:"rsync传输"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rsync传输","aria-hidden":"true"}},[a._v("#")]),a._v(" rsync传输")]),a._v(" "),e("p",[a._v("假设:")]),a._v(" "),e("ul",[e("li",[a._v("服务器地址为"),e("code",[a._v("${ip}")])]),a._v(" "),e("li",[a._v("帐户为"),e("code",[a._v("${user}")])]),a._v(" "),e("li",[a._v("密码为"),e("code",[a._v("${pass}")])]),a._v(" "),e("li",[a._v("源码包为"),e("code",[a._v("${zip}")])]),a._v(" "),e("li",[a._v("zip包放到服务器的目录为"),e("code",[a._v("${path}")])])]),a._v(" "),e("p",[a._v("则在本机源码包同级目录下，使用"),e("code",[a._v("scp")]),a._v("命令，把zip包传输至服务器的示例如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" -avzP ./"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${zip}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${user}")]),a._v("@"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ip}")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${path}")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 后面会提示输入密码")]),a._v("\n")])])]),e("h3",{attrs:{id:"ssh登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssh登录","aria-hidden":"true"}},[a._v("#")]),a._v(" ssh登录")]),a._v(" "),e("p",[a._v("承接上文，ssh登录服务器示例如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${user}")]),a._v("@"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ip}")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 后面会提示输入密码")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 第一次登录会提示保存ssh信息，输入yes即可")]),a._v("\n")])])]),e("p",[a._v("如果不想每次都输入地址/帐户/密码，可以写一个简单的自动登录脚本"),e("code",[a._v("ssh.sh")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建文件")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" ssh.sh\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 赋予脚本可执行权力")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x ssh.sh\n")])])]),e("p",[e("code",[a._v("ssh.sh")]),a._v("内容如下，记得把"),e("code",[a._v("${pass}")]),a._v(", "),e("code",[a._v("${user}")]),a._v(","),e("code",[a._v("${ip}")]),a._v("替换为真实数据")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#!/usr/bin/expect")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("timeout")]),a._v(" 30\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" password "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${pass}")]),a._v("\nspawn "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${user}")]),a._v("@"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ip}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("expect")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"*assword:"')]),a._v("\nsend "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$password")]),a._v('\\r"')]),a._v("\ninteract\n")])])]),e("p",[a._v("执行脚本即可登录服务器😄")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("./ssh.sh\n")])])]),e("h3",{attrs:{id:"unzip解压"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#unzip解压","aria-hidden":"true"}},[a._v("#")]),a._v(" unzip解压")]),a._v(" "),e("p",[a._v("如上所说，源码包名为"),e("code",[a._v("${zip}")]),a._v("，解压命令如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("unzip "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${zip}")]),a._v("\n")])])]),e("p",[a._v("附带一句, 如果要用命令生成zip包，假设源文件目录为"),e("code",[a._v("dist")]),a._v("，要生成的zip包为"),e("code",[a._v("dist.zip")]),a._v(", 其命令如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("zip")]),a._v(" -r dist.zip dist\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或简写为")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("zip")]),a._v(" -r dist dist\n")])])]),e("h3",{attrs:{id:"安装docker-ce"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-ce","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装Docker-CE")]),a._v(" "),e("p",[a._v("CE意为"),e("code",[a._v("Community Edition")]),a._v(", 即社区版，免费; 与之对应的是EE，"),e("code",[a._v("Enterprise Edition")]),a._v(",  企业版，强调安全，付费使用。")]),a._v(" "),e("ul",[e("li",[a._v("卸载旧版本的Docker")])]),a._v(" "),e("p",[a._v("如果新机器上没有docker，跳至下一步，直接安装Docker的依赖")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum remove docker \\\n                  docker-common \\\n                  container-selinux \\\n                  docker-selinux \\\n                  docker-engine \\\n                  docker-engine-selinux\n")])])]),e("ul",[e("li",[a._v("安装Docker的依赖")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -y yum-utils device-mapper-persistent-data lvm2\n")])])]),e("ul",[e("li",[a._v("安装Docker官方仓库")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n")])])]),e("ul",[e("li",[a._v("更新仓库源")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum makecache fast\n")])])]),e("ul",[e("li",[a._v("从仓库安装Docker-CE")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce\n")])])]),e("h3",{attrs:{id:"配置加速器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置加速器","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置加速器")]),a._v(" "),e("p",[a._v("使用 Docker 的时候，需要经常从官方获取镜像，但是由于显而易见的网络原因，拉取镜像的过程非常耗时，严重影响使用 Docker 的体验。")]),a._v(" "),e("p",[a._v("推荐使用"),e("a",{attrs:{href:"https://www.daocloud.io/mirror#accelerator-doc",target:"_blank",rel:"noopener noreferrer"}},[a._v("DaoCloud的加速器"),e("OutboundLink")],1)]),a._v(" "),e("h3",{attrs:{id:"dockerfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile","aria-hidden":"true"}},[a._v("#")]),a._v(" Dockerfile")]),a._v(" "),e("p",[a._v("所有环境配置已准备完毕，可以根据Node.js应用编写Dockerfile了")]),a._v(" "),e("p",[a._v("假设Node.js应用的启动命令为"),e("code",[a._v("npm start")]),a._v(", 监听端口为"),e("code",[a._v("${app_port}")])]),a._v(" "),e("ul",[e("li",[a._v("创建Dockerfile")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" Dockerfile\n")])])]),e("p",[e("code",[a._v("Dockerfile")]),a._v("内容如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可以指定依赖的node镜像的版本 node:<version>，如果不指定，就会是最新的")]),a._v("\nFROM node:8\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建工作目录，对应的是应用代码存放在容器内的路径")]),a._v("\nWORKDIR /usr/src/app\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 把 package.json，package-lock.json(npm@5+) 或 yarn.lock 复制到工作目录(相对路径)")]),a._v("\nCOPY package.json *.lock "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(".")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 只安装dependencies依赖")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# node镜像自带yarn")]),a._v("\nRUN yarn --only"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("prod --registry"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://registry.npm.taobao.org\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 把其他源文件复制到工作目录")]),a._v("\nCOPY "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(".")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(".")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换成应用实际的端口号")]),a._v("\nEXPOSE "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${app_port}")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 这里根据实际起动命令做修改")]),a._v("\nCMD "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"npm"')]),a._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"start"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),e("ul",[e("li",[a._v("补充.dockerignore")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" .dockerignore\n")])])]),e("p",[e("code",[a._v(".dockerignore")]),a._v("内容如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("node_modules\nnpm-debug.log\n")])])]),e("h3",{attrs:{id:"构建镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像","aria-hidden":"true"}},[a._v("#")]),a._v(" 构建镜像")]),a._v(" "),e("p",[a._v("写好"),e("code",[a._v("Dockerfile")]),a._v("，就可以在Dockerfile所在目录构建镜像了。")]),a._v(" "),e("p",[a._v("命令如下。"),e("code",[a._v("-t")]),a._v("是为了给镜像加个标签，这样方便使用"),e("code",[a._v("docker images")]),a._v("命令时检索到")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ${your_name} 可以省略")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ${tag} 省略时为 latest")]),a._v("\ndocker build -t "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${your_name}")]),a._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_name}")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${tag}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(".")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 省略版本")]),a._v("\ndocker build -t "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_name}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(".")]),a._v("\n")])])]),e("p",[a._v("查看镜像")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker images\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 示例输出")]),a._v("\nREPOSITORY                      TAG        ID              CREATED\nnode                            8          1934b0b038d1    5 days ago\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${your_name}")]),a._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_name}")]),a._v("    latest     d64d3505b0d2    1 minute ago\n")])])]),e("h3",{attrs:{id:"启动容器脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动容器脚本","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动容器脚本")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" start.sh\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x start.sh\n")])])]),e("p",[e("code",[a._v("start.sh")]),a._v("会根据镜像新建一个容器并启动，内容如下")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#!/usr/bin/env bash")]),a._v("\n\ncontainer"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${container_name}")]),a._v("\nimage"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_name || image_id}")]),a._v("\n\ndocker run \\\n--rm \\\n-d \\\n-p "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${host_port}")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${app_port}")]),a._v(" \\\n--name "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$container")]),a._v(" \\\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$image")]),a._v("\n")])])]),e("p",[e("code",[a._v("${host_port}")]),a._v("是外网访问部署好的应用时对应的端口")]),a._v(" "),e("p",[e("code",[a._v("${app_port}")]),a._v("是容器内Node.js应用监听的端口")]),a._v(" "),e("p",[e("code",[a._v("${image_name}")]),a._v("是前面构建出的镜像的名字，可用"),e("code",[a._v("docker images")]),a._v("查看")]),a._v(" "),e("p",[e("code",[a._v("${container_name}")]),a._v("是给容器赋予的名字，方便"),e("code",[a._v("docker ps")]),a._v("命令时检索")]),a._v(" "),e("p",[a._v("--rm 容器退出后随之将其删除")]),a._v(" "),e("p",[a._v("-d 后台运行")]),a._v(" "),e("p",[a._v("-p 指定端口映射，前者是服务器器端口，也即外界访问你部署好的web应用的端口; 后者是"),e("code",[a._v("Dockerfile")]),a._v("里"),e("code",[a._v("EXPOSE")]),a._v("的端口")]),a._v(" "),e("p",[a._v("--name 指定容器名字")]),a._v(" "),e("h3",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试","aria-hidden":"true"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),e("p",[a._v("访问刚刚启动的容器里的应用")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -i localhost:"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${host_port}")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 示例输出")]),a._v("\nHTTP/1.1 200 OK\nX-Powered-By: Express\nContent-Type: text/html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" charset"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf-8\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),e("p",[a._v("恭喜，部署成功👏")]),a._v(" "),e("h3",{attrs:{id:"常用命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用命令","aria-hidden":"true"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),e("ul",[e("li",[a._v("查看运行中的容器")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或使用新命令")]),a._v("\ndocker container "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 示例输出")]),a._v("\nID            IMAGE                                COMMAND    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".   PORTS\necce33b30ebf  "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${your_name}")]),a._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_name}")]),a._v(":latest  "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" start  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".   49160-"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("8080\n")])])]),e("ul",[e("li",[a._v("查看所有容器(包括已终止的)")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" -a\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或使用新命令")]),a._v("\ndocker container "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -a\n")])])]),e("ul",[e("li",[a._v("查看某容器内日志")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker logs -f "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${container_id}")]),a._v("\n")])])]),e("ul",[e("li",[a._v("进入某容器，并有shell执行环境")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# -i表示：交互式操作，-t表示：终端")]),a._v("\ndocker "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("exec")]),a._v(" -it "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${container_id}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可通过输入 exit 退出")]),a._v("\n")])])]),e("ul",[e("li",[a._v("停止容器")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker container stop "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${container_id}")]),a._v("\n")])])]),e("ul",[e("li",[a._v("启动已终止的容器")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker container start "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${container_id}")]),a._v("\n")])])]),e("ul",[e("li",[a._v("删除容器")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker container "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${container_name || container_id}")]),a._v("\n")])])]),e("ul",[e("li",[a._v("查看镜像")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker images\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或使用新命令")]),a._v("\ndocker image "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n")])])]),e("ul",[e("li",[a._v("删除镜像")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker image "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_id}")]),a._v("\n")])])]),e("h2",{attrs:{id:"faq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#faq","aria-hidden":"true"}},[a._v("#")]),a._v(" FAQ")]),a._v(" "),e("ul",[e("li",[a._v("不会vi，不懂怎么在服务器编辑"),e("code",[a._v("Dockerfile")]),a._v("等文件，怎么办？")])]),a._v(" "),e("blockquote",[e("p",[a._v("可以参考本文，把文件在本地创建好，再通过"),e("code",[a._v("scp")]),a._v("把创建的文件跟源码包一起上传到服务器")])]),a._v(" "),e("ul",[e("li",[a._v("为什么使用yarn?")])]),a._v(" "),e("blockquote",[e("p",[a._v("因为yarn的速度比npm更快，而docker里的node镜像自带了yarn, 正好鼓励大家使用yarn")])]),a._v(" "),e("ul",[e("li",[a._v("如果项目有全局依赖，如bower，Dockerfile怎么写？")])]),a._v(" "),e("blockquote",[e("p",[a._v("可以先安装其他全局依赖，再使用yarn安装，记得命令写在一个RUN指令里, 下面是部分示例")])]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("RUN yarn config "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" registry https://registry.npm.taobao.org \\\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" yarn global "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" bower \\\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" bower i --allow-root \\\n    yarn\n")])])]),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://nodejs.org/en/docs/guides/nodejs-docker-webapp",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://nodejs.org/en/docs/guides/nodejs-docker-webapp"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/nodejs/docker-node/blob/master/README.md#image-variants",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/nodejs/docker-node/blob/master/README.md#image-variants"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/waylybaye/HyperApp-Guide/blob/master/zh/centos-upgrade-docker.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/waylybaye/HyperApp-Guide/blob/master/zh/centos-upgrade-docker.md"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://docs.docker.com/v1.11/engine/reference/commandline/cli/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker命令查询"),e("OutboundLink")],1)])]),a._v(" "),e("h2",{attrs:{id:"注"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注","aria-hidden":"true"}},[a._v("#")]),a._v(" 注")]),a._v(" "),e("p",[a._v("本文最早发布在掘金，后迁移至"),e("a",{attrs:{href:"https://github.com/levy9527/blog/issues/3",target:"_blank",rel:"noopener noreferrer"}},[a._v("github"),e("OutboundLink")],1),a._v("。")])])},[],!1,null,null,null);s.default=r.exports}}]);