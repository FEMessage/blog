(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{218:function(t,a,s){"use strict";s.r(a);var e=s(2),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"🚀github集成travis-ci：自动发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🚀github集成travis-ci：自动发布","aria-hidden":"true"}},[t._v("#")]),t._v(" 🚀Github集成Travis CI：自动发布")]),t._v(" "),s("h1",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("已经有阮一峰老师的"),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("持续集成服务 Travis CI 教程"),s("OutboundLink")],1),t._v("，为什么还要写这篇文章？")]),t._v(" "),s("p",[t._v("原因有二：")]),t._v(" "),s("ol",[s("li",[t._v("文章内容有些过时")]),t._v(" "),s("li",[t._v("文章覆盖度不够，有些实践细节没写出来")])]),t._v(" "),s("p",[t._v("由于以上原因，纵然可以笔者很快在Github集成Travis CI并成功构建，但在发布时却踩了一些坑，折腾一波才终于发布成功。故写下此文，旨在补充更多的细节，帮助他人少走弯路。")]),t._v(" "),s("h1",{attrs:{id:"正文"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正文","aria-hidden":"true"}},[t._v("#")]),t._v(" 正文")]),t._v(" "),s("h2",{attrs:{id:"免费购买travis-ci应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#免费购买travis-ci应用","aria-hidden":"true"}},[t._v("#")]),t._v(" 免费购买Travis CI应用")]),t._v(" "),s("p",[t._v("点击 "),s("a",{attrs:{href:"https://github.com/marketplace/travis-ci",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/marketplace/travis-ci"),s("OutboundLink")],1),t._v("，登录后免费购买(开源项目集成Travis CI不收费)。")]),t._v(" "),s("h2",{attrs:{id:"选择关联仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选择关联仓库","aria-hidden":"true"}},[t._v("#")]),t._v(" 选择关联仓库")]),t._v(" "),s("p",[t._v("选择个人或组织名下需要关联Travis CI的Github仓库。")]),t._v(" "),s("p",[t._v("已经设置过的，想进行修改，可以在Github的 Personal settings-> Applications 中进入。"),s("br"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552699916365-0a309745-c830-480e-8c8f-58b2dde3f7bc.png#align=left&display=inline&height=285&originHeight=381&originWidth=227&size=0&status=done&width=170#align=left&display=inline&height=381&originHeight=381&originWidth=227&status=done&width=227",alt:""}}),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552695398638-13ec5516-3002-4a74-bf08-099b32f2b612.png#align=left&display=inline&height=259&name=image.png&originHeight=958&originWidth=1992&size=408088&status=done&width=538#align=left&display=inline&height=359&originHeight=958&originWidth=1992&status=done&width=746",alt:"image.png"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552695750384-cc7d516e-c10d-4553-8811-84ac13f3ee4f.png#align=left&display=inline&height=352&originHeight=632&originWidth=1340&status=done&width=746",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"编写ci文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写ci文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 编写CI文件")]),t._v(" "),s("p",[t._v("在项目根目录下新建 "),s("code",[t._v(".travis.yml")]),t._v(" 文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" .travis.yml\n")])])]),s("h3",{attrs:{id:"发布到github-pages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到github-pages","aria-hidden":"true"}},[t._v("#")]),t._v(" 发布到github pages")]),t._v(" "),s("p",[t._v("下面展示一个可以发布到gh-pages的例子，可以稍做修改，复制粘贴使用。")]),t._v(" "),s("p",[t._v("该示例包含了：")]),t._v(" "),s("ul",[s("li",[t._v("指定node.js版本")]),t._v(" "),s("li",[t._v("使用yarn进行安装依赖及构建")]),t._v(" "),s("li",[t._v("对安装需要的依赖进行了缓存")]),t._v(" "),s("li",[t._v("设置了两个不含敏感信息的环境变量")]),t._v(" "),s("li",[t._v("设置了一个含有敏感信息的环境变量")]),t._v(" "),s("li",[t._v("把构建生成的文件部署至github pages")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_js\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node_js")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" lts/*\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" API_SERVER=https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//easy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mock.com/mock/5c1b3895fe5907404e654045/femessage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mock PUBLIC_PATH=http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//levy.work/nuxt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("element"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认是yarn, 如果有yarn.lock的话")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认是 yarn test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn build\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip-cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keep-history")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local-dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dist\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github-token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $GITHUB_TOKEN\n")])])]),s("p",[t._v("下面对文件进行说明。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_js\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node_js")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" lts/*\n")])])]),s("ul",[s("li",[t._v("第1行指定了构建环境为node.js")]),t._v(" "),s("li",[t._v("第2、3行指定使用node.js最新的LTS版本")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" API_SERVER=xxx PUBLIC_PATH=xxx\n")])])]),s("p",[t._v("上面是设置两个环境变量。")]),t._v(" "),s("p",[t._v("注意，一次构建中传多个环境变量，必须写在同一行，使用空格分开。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" API_SERVER=xxx \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" PUBLIC_PATH=xxx\n")])])]),s("p",[t._v("如果写成上面的形式，则会变成两个构建，每一个构建中只有一个环境变量。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn build\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn\n")])])]),s("p",[t._v("上面指定使用yarn进行安装依赖，安装好后执行 "),s("code",[t._v("yarn build")]),t._v(" 命令; 为yarn的依赖加速安装，开启了缓存。")]),t._v(" "),s("p",[t._v("下面是最关键的部署配置。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github-token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $GITHUB_TOKEN\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip-cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keep-history")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local-dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dist\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n")])])]),s("ul",[s("li",[t._v("第2行指定部署到Github Pages，即仓库的 "),s("code",[t._v("gh-pages")]),t._v(" 分支，请确保仓库的pages分支是 "),s("code",[t._v("gh-pages")]),t._v(" , "),s("a",{attrs:{href:"#b637c71e"}},[t._v("相关操作可以看这里")])]),t._v(" "),s("li",[t._v("第3行指定保留构建后的文件")]),t._v(" "),s("li",[t._v("第4行指定每次部署会新增一个提交记录再推送，而不是使用 "),s("code",[t._v("git push --force")])]),t._v(" "),s("li",[t._v("第5行指定构建后要部署的目录")]),t._v(" "),s("li",[t._v("第6、7行指定 "),s("code",[t._v("master")]),t._v(" 分支有提交行为时，将触发构建后部署")]),t._v(" "),s("li",[t._v("第8行是部署需要用到的"),s("code",[t._v("github-token")]),t._v(",其中"),s("code",[t._v("$GITHUB_TOKEN")]),t._v("是变量，它可以在Travis CI个人仓库的setting页里设置，"),s("a",{attrs:{href:"#74ae38aa"}},[t._v("相关操作可以看这里")])])]),t._v(" "),s("h3",{attrs:{id:"发布到npm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到npm","aria-hidden":"true"}},[t._v("#")]),t._v(" 发布到npm")]),t._v(" "),s("p",[t._v("再给出把node.js模块发布到npm的例子")]),t._v(" "),s("p",[t._v("主要是 "),s("code",[t._v("deploy")]),t._v(" 这里有所不同")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <your_email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# api_key: travis encrypt NPM_TOKEN --add deploy.api_key --com")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip-cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("api_key指的的npm的token，可以登录npm后，在个人中心生成"),s("br"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1555237926690-d79ff285-afdc-4ff8-ab58-3693930e57dc.png#align=left&display=inline&height=344&originHeight=688&originWidth=1944&size=0&status=done&width=972",alt:""}})]),t._v(" "),s("p",[t._v("因为不能泄露，所以要通过travis ci的命令行工具进行加密，执行以下命令")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("travis encrypt NPM_TOKEN --add deploy.api_key --com\n")])])]),s("h3",{attrs:{id:"复杂例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复杂例子","aria-hidden":"true"}},[t._v("#")]),t._v(" 复杂例子")]),t._v(" "),s("p",[t._v("下面是一个复杂的例子，也是实际用到的配置，主要是")]),t._v(" "),s("ul",[s("li",[t._v("master分支才会触发构建")]),t._v(" "),s("li",[t._v("执行script命令前先读取shell中的环境变量，并生成"),s("code",[t._v(".env")]),t._v("文件")]),t._v(" "),s("li",[t._v("构建成功后\n"),s("ul",[s("li",[t._v("把模块发布到npm")]),t._v(" "),s("li",[t._v("把文档发布到gh-pages")])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_js\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node_js")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" lts/*\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("git")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depth")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("frozen"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("lockfile\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo OSS_KEY=$OSS_KEY\\\\nOSS_SECRET=$OSS_SECRET\\\\nOSS_BUCKET=$=OSS_BUCKET\\\\nOSS_REGION=$OSS_REGION "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" .env\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn build\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local-dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docs\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github-token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $GITHUB_TOKEN\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip-cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keep-history")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("email")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" levy9527@qq.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("api_key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $NPM_TOKEN\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip-cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("h2",{attrs:{id:"相关操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关操作","aria-hidden":"true"}},[t._v("#")]),t._v(" 相关操作")]),t._v(" "),s("h3",{attrs:{id:"使用travis命令行工具加密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用travis命令行工具加密","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用travis命令行工具加密")]),t._v(" "),s("p",[t._v("加密要用到travis命令行工具，如果是在travis ci web界面设置环境变量，则可直接跳过。")]),t._v(" "),s("p",[t._v("下面给出mac环境下操作需要注意的点")]),t._v(" "),s("p",[t._v("1.安装命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("brew "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" travis\n")])])]),s("p",[t._v("否则很可能会出现"),s("a",{attrs:{href:"https://github.com/travis-ci/travis.rb/issues/190",target:"_blank",rel:"noopener noreferrer"}},[t._v("问题"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("2.确保在 https://travis-ci.org/ sign in with github")]),t._v(" "),s("p",[t._v("3.然后在项目根目录里，执行命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("travis login —auto\n")])])]),s("p",[t._v("4.修改git设置")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" .git/config\n")])])]),s("p",[t._v("确保")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("travis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  slug "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 是你在travis关联的仓库\n")])])]),s("p",[t._v("5.添加加密环境变量")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("travis encrypt github-token"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx --add deploy.github-token --com\n")])])]),s("p",[t._v("因为笔者登录的travis ci域名是 "),s("a",{attrs:{href:"https://travis-ci.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://travis-ci.com"),s("OutboundLink")],1),t._v("，所以要带参数 "),s("code",[t._v("--com")]),t._v(" ， 默认是 "),s("a",{attrs:{href:"https://travis-ci.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://travis-ci.org"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"通过环境变量设置github-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过环境变量设置github-token","aria-hidden":"true"}},[t._v("#")]),t._v(" 通过环境变量设置GITHUB_TOKEN")]),t._v(" "),s("p",[t._v("首先为Travis CI新建一个token"),s("br"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552699916365-0a309745-c830-480e-8c8f-58b2dde3f7bc.png#align=left&display=inline&height=285&name=&originHeight=381&originWidth=227&status=done&width=170#align=left&display=inline&height=381&originHeight=381&originWidth=227&status=done&width=227",alt:""}}),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552699974567-7208da19-fdb5-4c43-b19b-61acfb4c4783.png#align=left&display=inline&height=184&name=&originHeight=184&originWidth=254&size=0&status=done&width=254#align=left&display=inline&height=184&originHeight=184&originWidth=254&status=done&width=254",alt:""}}),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552700133575-16c48b5a-fe9c-4eb4-a6ab-cf4e066d5881.png#align=left&display=inline&height=204&name=&originHeight=204&originWidth=262&size=0&status=done&width=262#align=left&display=inline&height=204&originHeight=204&originWidth=262&status=done&width=262",alt:""}})]),t._v(" "),s("p",[t._v("点击生成新token"),s("br"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/png/160590/1552700229186-44a679d9-254f-4377-94bd-ac115e345cec.png#align=left&display=inline&height=64&name=&originHeight=82&originWidth=961&size=0&status=done&width=746#align=left&display=inline&height=64&originHeight=82&originWidth=961&status=done&width=746",alt:""}})]),t._v(" "),s("p",[t._v("设置权限")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://camo.githubusercontent.com/ebf7a6eb9efa27c6e67aa6f4a619600d552177f8/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323730303335313531302d35363965386361642d656363342d343230612d613763302d6439346366383761363633322e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d353136266e616d653d696d6167652e706e67266f726967696e4865696768743d31303332266f726967696e57696474683d313232382673697a653d353938333234267374617475733d646f6e652677696474683d36313423616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363237266f726967696e4865696768743d31303332266f726967696e57696474683d31323238267374617475733d646f6e652677696474683d373436",alt:"image.png"}}),s("br"),t._v("复制生成的token。(记得先不要刷新或离开当前页面，否则token就看不见了，只能重新生成)")]),t._v(" "),s("p",[t._v("登录Travis CI, 进入要集成的项目设置页。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://camo.githubusercontent.com/f85e1e3768101a72602e4196cd116ce8e3ef7400/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323730303630363736332d38303235396132322d653330652d343734652d616535302d6333313935383336376631662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d333438266e616d653d696d6167652e706e67266f726967696e4865696768743d363936266f726967696e57696474683d323534302673697a653d343334323739267374617475733d646f6e652677696474683d3132373023616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323034266f726967696e4865696768743d363936266f726967696e57696474683d32353430267374617475733d646f6e652677696474683d373436",alt:"image.png"}})]),t._v(" "),s("p",[t._v("添加环境变量"),s("code",[t._v("GITHUB_TOKEN")])]),t._v(" "),s("p",[t._v("注意，这里的环境变量是通过bash设置、并在.yml里读取的，所以变量名是大写加下划线形式，这是bash的最佳实践，千万别写成"),s("code",[t._v("github-token")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://camo.githubusercontent.com/79fc1975b05507406c16199e74ff88dcc5135b86/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323730303639323934352d64633864633631362d363832392d346332622d616661652d3931353062613030313339382e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d333030266e616d653d696d6167652e706e67266f726967696e4865696768743d363030266f726967696e57696474683d313930362673697a653d323236383538267374617475733d646f6e652677696474683d39353323616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323335266f726967696e4865696768743d363030266f726967696e57696474683d31393036267374617475733d646f6e652677696474683d373436",alt:"image.png"}})]),t._v(" "),s("h3",{attrs:{id:"github-pages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-pages","aria-hidden":"true"}},[t._v("#")]),t._v(" GitHub Pages")]),t._v(" "),s("p",[t._v("查看"),s("code",[t._v("gh-pages")]),t._v("分支的部署情况")]),t._v(" "),s("p",[t._v("进入仓库 Settings -> Options")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://camo.githubusercontent.com/04cd0a6cfed07d7ffbdc94dd5b6d2581e4b5e308/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323639393539363430322d30383230346638612d356633362d343938362d616262372d6530623365616137616236652e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d313030266e616d653d696d6167652e706e67266f726967696e4865696768743d323030266f726967696e57696474683d313630362673697a653d313134343838267374617475733d646f6e652677696474683d38303323616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d3933266f726967696e4865696768743d323030266f726967696e57696474683d31363036267374617475733d646f6e652677696474683d373436",alt:"image.png"}})]),t._v(" "),s("p",[t._v("往下翻看，可以看到效果"),s("br"),s("img",{attrs:{src:"https://camo.githubusercontent.com/39c0771c595e8532683831f8c5a1a67c43ab5886/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323639393633313630352d37623031386334612d396534662d343430352d393432332d3933343566336162313665332e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323434266e616d653d696d6167652e706e67266f726967696e4865696768743d343838266f726967696e57696474683d313338302673697a653d323738373434267374617475733d646f6e652677696474683d36393023616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323634266f726967696e4865696768743d343838266f726967696e57696474683d31333830267374617475733d646f6e652677696474683d373436",alt:"image.png"}}),s("br"),t._v("因为笔者自定义了域名，所以地址不是默认的 "),s("a",{attrs:{href:"https://xxx.github.io/xxx",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://xxx.github.io/xxx"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"注"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注","aria-hidden":"true"}},[t._v("#")]),t._v(" 注")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/levy9527/blog/issues/1",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文地址"),s("OutboundLink")],1)])])},[],!1,null,null,null);a.default=n.exports}}]);