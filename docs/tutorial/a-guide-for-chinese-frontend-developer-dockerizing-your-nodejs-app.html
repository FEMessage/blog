<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🐳从零开始Docker化Node.js应用 | FEMessage blog</title>
    <meta name="description" content="things every member should konw">
    <link rel="icon" href="https://avatars3.githubusercontent.com/u/39977793?s=200&amp;v=4">
    
    <link rel="preload" href="/blog/assets/css/0.styles.7a18dcc6.css" as="style"><link rel="preload" href="/blog/assets/js/app.3b8fd8ff.js" as="script"><link rel="preload" href="/blog/assets/js/2.acf68d8b.js" as="script"><link rel="preload" href="/blog/assets/js/28.35749832.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.5ad27908.js"><link rel="prefetch" href="/blog/assets/js/11.3ab112bc.js"><link rel="prefetch" href="/blog/assets/js/12.f9248c70.js"><link rel="prefetch" href="/blog/assets/js/13.2d569f81.js"><link rel="prefetch" href="/blog/assets/js/14.04c2b1b3.js"><link rel="prefetch" href="/blog/assets/js/15.ca9221f8.js"><link rel="prefetch" href="/blog/assets/js/16.b0543377.js"><link rel="prefetch" href="/blog/assets/js/17.e1ee037e.js"><link rel="prefetch" href="/blog/assets/js/18.96fd91a0.js"><link rel="prefetch" href="/blog/assets/js/19.12894fc8.js"><link rel="prefetch" href="/blog/assets/js/20.2b016a9c.js"><link rel="prefetch" href="/blog/assets/js/21.1266966d.js"><link rel="prefetch" href="/blog/assets/js/22.65aedd87.js"><link rel="prefetch" href="/blog/assets/js/23.13b1a955.js"><link rel="prefetch" href="/blog/assets/js/24.935a9f39.js"><link rel="prefetch" href="/blog/assets/js/25.3ba8864c.js"><link rel="prefetch" href="/blog/assets/js/26.962211d0.js"><link rel="prefetch" href="/blog/assets/js/27.3b39b8d2.js"><link rel="prefetch" href="/blog/assets/js/29.c21efca1.js"><link rel="prefetch" href="/blog/assets/js/3.3faf71fd.js"><link rel="prefetch" href="/blog/assets/js/30.0457aba8.js"><link rel="prefetch" href="/blog/assets/js/31.66d8bfbb.js"><link rel="prefetch" href="/blog/assets/js/32.d9e6cf38.js"><link rel="prefetch" href="/blog/assets/js/33.bb99edf2.js"><link rel="prefetch" href="/blog/assets/js/34.34b16699.js"><link rel="prefetch" href="/blog/assets/js/35.d6a123cd.js"><link rel="prefetch" href="/blog/assets/js/36.414b1b84.js"><link rel="prefetch" href="/blog/assets/js/37.4acac353.js"><link rel="prefetch" href="/blog/assets/js/38.4056b126.js"><link rel="prefetch" href="/blog/assets/js/39.a6376cc7.js"><link rel="prefetch" href="/blog/assets/js/4.78dc510e.js"><link rel="prefetch" href="/blog/assets/js/5.3e614226.js"><link rel="prefetch" href="/blog/assets/js/6.4547ba14.js"><link rel="prefetch" href="/blog/assets/js/7.23588dac.js"><link rel="prefetch" href="/blog/assets/js/8.cb6fc9e8.js"><link rel="prefetch" href="/blog/assets/js/9.2dfce0f7.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.7a18dcc6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">FEMessage blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/FEMessage/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/FEMessage/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/coding/basic-knowledge.html" class="sidebar-link">前端基础</a></li><li><a href="/blog/docs/coding/before-coding.html" class="sidebar-link">编程修养</a></li><li><a href="/blog/docs/coding/clean-code-tips.html" class="sidebar-link">编码技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程故事</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/coding-story/achieve-commitment-and-deliver-available-software.html" class="sidebar-link">履行承诺，交付可用的功能</a></li><li><a href="/blog/docs/coding-story/how-can-we-fix-200-bugs-in-a-week.html" class="sidebar-link">一周消灭200个bug</a></li><li><a href="/blog/docs/coding-story/practice-collective-ownership.html" class="sidebar-link">编程接力</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件研发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-1-the-workflow.html" class="sidebar-link">组件研发指南（一）：研发流程</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-2-hosting-in-private-registry.html" class="sidebar-link">组件研发指南（二）：私服托管</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-3-the-open-source-guide.html" class="sidebar-link">组件研发指南（三）：开源协作</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-4-thinking-improvement.html" class="sidebar-link">组件研发指南（四）：思维提升</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-5-some-tips-may-help.html" class="sidebar-link">组件研发指南（五）：基础拾遗</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GIT指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/git/git-best-pratices.html" class="sidebar-link">GIT最佳实践</a></li><li><a href="/blog/docs/git/git-common-commands.html" class="sidebar-link">GIT常用命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>软技能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/soft-skill/rules-of-thumb-and-nuggets-of-wisdom.html" class="sidebar-link">经验法则与至理名言</a></li><li><a href="/blog/docs/soft-skill/search-tips.html" class="sidebar-link">搜索技巧</a></li><li><a href="/blog/docs/soft-skill/the-pyramid-priceple-using-in-github-pr.html" class="sidebar-link">金字塔原理在Github PR中的运用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html" class="active sidebar-link">🐳从零开始Docker化Node.js应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html#方案" class="sidebar-link">方案</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html#faq" class="sidebar-link">FAQ</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html#注" class="sidebar-link">注</a></li></ul></li><li><a href="/blog/docs/tutorial/best-pratices-to-publish-vue-component-via-npm.html" class="sidebar-link">📦vue组件发布npm最佳实践</a></li><li><a href="/blog/docs/tutorial/capture-and-rewrite-https-request.html" class="sidebar-link">🕸捕获与改写HTTPS请求</a></li><li><a href="/blog/docs/tutorial/decode-base64-in-utf8.html" class="sidebar-link">解码base64的utf-8字符串</a></li><li><a href="/blog/docs/tutorial/how-to-write-a-github-app.html" class="sidebar-link">🤖如何写一个Github App</a></li><li><a href="/blog/docs/tutorial/integrate-github-with-netlify-to-preview-changes.html" class="sidebar-link">⚡️Github集成Netlify：快速预览PR</a></li><li><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html" class="sidebar-link">🚀Github集成Travis CI：自动发布</a></li><li><a href="/blog/docs/tutorial/reveal-the-secret-of-a-powerful-tool-to-develop-vue-single-file-compoent.html" class="sidebar-link">🔨揭秘vue-sfc-cli：组件研发利器</a></li><li><a href="/blog/docs/tutorial/setup-an-automated-github-workflow.html" class="sidebar-link">🌪自动化的Github Workflow</a></li><li><a href="/blog/docs/tutorial/test-driven-development-by-jest.html" class="sidebar-link">✅使用jest进行测试驱动开发</a></li><li><a href="/blog/docs/tutorial/use-free-https-service.html" class="sidebar-link">🔒免费开启HTTPS</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="🐳从零开始docker化node-js应用"><a href="#🐳从零开始docker化node-js应用" aria-hidden="true" class="header-anchor">#</a> 🐳从零开始Docker化Node.js应用</h1> <h2 id="背景"><a href="#背景" aria-hidden="true" class="header-anchor">#</a> 背景</h2> <p>给你一台新买的服务器(CentOS)，相关账户及密码，一个基于Node.js开发的web应用源码包(zip)，要求你在新机器上使用Docker的方式把应用部署起来。此时的你，并没有搞清楚什么是容器/镜像，也没记住几个相关的Linux命令，该怎么办？本文将帮助你摆脱困境</p> <h2 id="方案"><a href="#方案" aria-hidden="true" class="header-anchor">#</a> 方案</h2> <h3 id="流程"><a href="#流程" aria-hidden="true" class="header-anchor">#</a> 流程</h3> <p>为达到最终目的，先来梳理一波流程：</p> <ol><li>把源码zip包上传至服务器</li> <li>登录服务器</li> <li>解压zip包</li> <li>安装最新Docker</li> <li>设置国内镜像加速器</li> <li>编写Dockerfile</li> <li>构建镜像</li> <li>编写启动容器脚本</li> <li>执行脚本，检查部署情况</li></ol> <p>下面将详细描述如何操作</p> <blockquote><p>文中服务器操作系统为CentOS 7，如果你的服务器不相符，操作细节可能会略有不同，需要另行查阅相关资料</p></blockquote> <h3 id="rsync传输"><a href="#rsync传输" aria-hidden="true" class="header-anchor">#</a> rsync传输</h3> <p>假设:</p> <ul><li>服务器地址为<code>${ip}</code></li> <li>帐户为<code>${user}</code></li> <li>密码为<code>${pass}</code></li> <li>源码包为<code>${zip}</code></li> <li>zip包放到服务器的目录为<code>${path}</code></li></ul> <p>则在本机源码包同级目录下，使用<code>scp</code>命令，把zip包传输至服务器的示例如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">rsync</span> -avzP ./<span class="token variable">${zip}</span> <span class="token variable">${user}</span>@<span class="token variable">${ip}</span><span class="token keyword">:</span><span class="token variable">${path}</span>

<span class="token comment"># 后面会提示输入密码</span>
</code></pre></div><h3 id="ssh登录"><a href="#ssh登录" aria-hidden="true" class="header-anchor">#</a> ssh登录</h3> <p>承接上文，ssh登录服务器示例如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">ssh</span> <span class="token variable">${user}</span>@<span class="token variable">${ip}</span>

<span class="token comment"># 后面会提示输入密码</span>
<span class="token comment"># 第一次登录会提示保存ssh信息，输入yes即可</span>
</code></pre></div><p>如果不想每次都输入地址/帐户/密码，可以写一个简单的自动登录脚本<code>ssh.sh</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 创建文件</span>
<span class="token function">touch</span> ssh.sh
<span class="token comment"># 赋予脚本可执行权力</span>
<span class="token function">chmod</span> +x ssh.sh
</code></pre></div><p><code>ssh.sh</code>内容如下，记得把<code>${pass}</code>, <code>${user}</code>,<code>${ip}</code>替换为真实数据</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#!/usr/bin/expect</span>
<span class="token keyword">set</span> <span class="token function">timeout</span> 30
<span class="token keyword">set</span> password <span class="token variable">${pass}</span>
spawn <span class="token function">ssh</span> <span class="token variable">${user}</span>@<span class="token variable">${ip}</span>
<span class="token function">expect</span> <span class="token string">&quot;*assword:&quot;</span>
send <span class="token string">&quot;<span class="token variable">$password</span>\r&quot;</span>
interact
</code></pre></div><p>执行脚本即可登录服务器😄</p> <div class="language-sh extra-class"><pre class="language-sh"><code>./ssh.sh
</code></pre></div><h3 id="unzip解压"><a href="#unzip解压" aria-hidden="true" class="header-anchor">#</a> unzip解压</h3> <p>如上所说，源码包名为<code>${zip}</code>，解压命令如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code>unzip <span class="token variable">${zip}</span>
</code></pre></div><p>附带一句, 如果要用命令生成zip包，假设源文件目录为<code>dist</code>，要生成的zip包为<code>dist.zip</code>, 其命令如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">zip</span> -r dist.zip dist
<span class="token comment"># 或简写为</span>
<span class="token function">zip</span> -r dist dist
</code></pre></div><h3 id="安装docker-ce"><a href="#安装docker-ce" aria-hidden="true" class="header-anchor">#</a> 安装Docker-CE</h3> <p>CE意为<code>Community Edition</code>, 即社区版，免费; 与之对应的是EE，<code>Enterprise Edition</code>,  企业版，强调安全，付费使用。</p> <ul><li>卸载旧版本的Docker</li></ul> <p>如果新机器上没有docker，跳至下一步，直接安装Docker的依赖</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> yum remove docker \
                  docker-common \
                  container-selinux \
                  docker-selinux \
                  docker-engine \
                  docker-engine-selinux
</code></pre></div><ul><li>安装Docker的依赖</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2
</code></pre></div><ul><li>安装Docker官方仓库</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre></div><ul><li>更新仓库源</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> yum makecache fast
</code></pre></div><ul><li>从仓库安装Docker-CE</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce
</code></pre></div><h3 id="配置加速器"><a href="#配置加速器" aria-hidden="true" class="header-anchor">#</a> 配置加速器</h3> <p>使用 Docker 的时候，需要经常从官方获取镜像，但是由于显而易见的网络原因，拉取镜像的过程非常耗时，严重影响使用 Docker 的体验。</p> <p>推荐使用<a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener noreferrer">DaoCloud的加速器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="header-anchor">#</a> Dockerfile</h3> <p>所有环境配置已准备完毕，可以根据Node.js应用编写Dockerfile了</p> <p>假设Node.js应用的启动命令为<code>npm start</code>, 监听端口为<code>${app_port}</code></p> <ul><li>创建Dockerfile</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> Dockerfile
</code></pre></div><p><code>Dockerfile</code>内容如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 可以指定依赖的node镜像的版本 node:&lt;version&gt;，如果不指定，就会是最新的</span>
FROM node:8

<span class="token comment"># 创建工作目录，对应的是应用代码存放在容器内的路径</span>
WORKDIR /usr/src/app

<span class="token comment"># 把 package.json，package-lock.json(npm@5+) 或 yarn.lock 复制到工作目录(相对路径)</span>
COPY package.json *.lock <span class="token keyword">.</span>

<span class="token comment"># 只安装dependencies依赖</span>
<span class="token comment"># node镜像自带yarn</span>
RUN yarn --only<span class="token operator">=</span>prod --registry<span class="token operator">=</span>https://registry.npm.taobao.org

<span class="token comment"># 把其他源文件复制到工作目录</span>
COPY <span class="token keyword">.</span> <span class="token keyword">.</span>

<span class="token comment"># 替换成应用实际的端口号</span>
EXPOSE <span class="token variable">${app_port}</span>

<span class="token comment"># 这里根据实际起动命令做修改</span>
CMD <span class="token punctuation">[</span> <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span>
</code></pre></div><ul><li>补充.dockerignore</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> .dockerignore
</code></pre></div><p><code>.dockerignore</code>内容如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code>node_modules
npm-debug.log
</code></pre></div><h3 id="构建镜像"><a href="#构建镜像" aria-hidden="true" class="header-anchor">#</a> 构建镜像</h3> <p>写好<code>Dockerfile</code>，就可以在Dockerfile所在目录构建镜像了。</p> <p>命令如下。<code>-t</code>是为了给镜像加个标签，这样方便使用<code>docker images</code>命令时检索到</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># ${your_name} 可以省略</span>
<span class="token comment"># ${tag} 省略时为 latest</span>
docker build -t <span class="token variable">${your_name}</span>/<span class="token variable">${image_name}</span><span class="token keyword">:</span><span class="token variable">${tag}</span> <span class="token keyword">.</span>

<span class="token comment"># 省略版本</span>
docker build -t <span class="token variable">${image_name}</span> <span class="token keyword">.</span>
</code></pre></div><p>查看镜像</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker images

<span class="token comment"># 示例输出</span>
REPOSITORY                      TAG        ID              CREATED
node                            8          1934b0b038d1    5 days ago
<span class="token variable">${your_name}</span>/<span class="token variable">${image_name}</span>    latest     d64d3505b0d2    1 minute ago
</code></pre></div><h3 id="启动容器脚本"><a href="#启动容器脚本" aria-hidden="true" class="header-anchor">#</a> 启动容器脚本</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> start.sh
<span class="token function">chmod</span> +x start.sh
</code></pre></div><p><code>start.sh</code>会根据镜像新建一个容器并启动，内容如下</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#!/usr/bin/env bash</span>

container<span class="token operator">=</span><span class="token variable">${container_name}</span>
image<span class="token operator">=</span><span class="token variable">${image_name || image_id}</span>

docker run \
--rm \
-d \
-p <span class="token variable">${host_port}</span><span class="token keyword">:</span><span class="token variable">${app_port}</span> \
--name <span class="token variable">$container</span> \
<span class="token variable">$image</span>
</code></pre></div><p><code>${host_port}</code>是外网访问部署好的应用时对应的端口</p> <p><code>${app_port}</code>是容器内Node.js应用监听的端口</p> <p><code>${image_name}</code>是前面构建出的镜像的名字，可用<code>docker images</code>查看</p> <p><code>${container_name}</code>是给容器赋予的名字，方便<code>docker ps</code>命令时检索</p> <p>--rm 容器退出后随之将其删除</p> <p>-d 后台运行</p> <p>-p 指定端口映射，前者是服务器器端口，也即外界访问你部署好的web应用的端口; 后者是<code>Dockerfile</code>里<code>EXPOSE</code>的端口</p> <p>--name 指定容器名字</p> <h3 id="测试"><a href="#测试" aria-hidden="true" class="header-anchor">#</a> 测试</h3> <p>访问刚刚启动的容器里的应用</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> -i localhost:<span class="token variable">${host_port}</span>

<span class="token comment"># 示例输出</span>
HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: text/html<span class="token punctuation">;</span> charset<span class="token operator">=</span>utf-8
<span class="token punctuation">..</span>.
</code></pre></div><p>恭喜，部署成功👏</p> <h3 id="常用命令"><a href="#常用命令" aria-hidden="true" class="header-anchor">#</a> 常用命令</h3> <ul><li>查看运行中的容器</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker <span class="token function">ps</span>
<span class="token comment"># 或使用新命令</span>
docker container <span class="token function">ls</span>

<span class="token comment"># 示例输出</span>
ID            IMAGE                                COMMAND    <span class="token punctuation">..</span>.   PORTS
ecce33b30ebf  <span class="token variable">${your_name}</span>/<span class="token variable">${image_name}</span>:latest  <span class="token function">npm</span> start  <span class="token punctuation">..</span>.   49160-<span class="token operator">&gt;</span>8080
</code></pre></div><ul><li>查看所有容器(包括已终止的)</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker <span class="token function">ps</span> -a
<span class="token comment"># 或使用新命令</span>
docker container <span class="token function">ls</span> -a
</code></pre></div><ul><li>查看某容器内日志</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker logs -f <span class="token variable">${container_id}</span>
</code></pre></div><ul><li>进入某容器，并有shell执行环境</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 进入容器</span>
<span class="token comment"># -i表示：交互式操作，-t表示：终端</span>
docker <span class="token function">exec</span> -it <span class="token variable">${container_id}</span> <span class="token function">bash</span>
<span class="token comment"># 可通过输入 exit 退出</span>
</code></pre></div><ul><li>停止容器</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker container stop <span class="token variable">${container_id}</span>
</code></pre></div><ul><li>启动已终止的容器</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker container start <span class="token variable">${container_id}</span>
</code></pre></div><ul><li>删除容器</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker container <span class="token function">rm</span> <span class="token variable">${container_name || container_id}</span>
</code></pre></div><ul><li>查看镜像</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker images
<span class="token comment"># 或使用新命令</span>
docker image <span class="token function">ls</span>
</code></pre></div><ul><li>删除镜像</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker image <span class="token function">rm</span> <span class="token variable">${image_id}</span>
</code></pre></div><h2 id="faq"><a href="#faq" aria-hidden="true" class="header-anchor">#</a> FAQ</h2> <ul><li>不会vi，不懂怎么在服务器编辑<code>Dockerfile</code>等文件，怎么办？</li></ul> <blockquote><p>可以参考本文，把文件在本地创建好，再通过<code>scp</code>把创建的文件跟源码包一起上传到服务器</p></blockquote> <ul><li>为什么使用yarn?</li></ul> <blockquote><p>因为yarn的速度比npm更快，而docker里的node镜像自带了yarn, 正好鼓励大家使用yarn</p></blockquote> <ul><li>如果项目有全局依赖，如bower，Dockerfile怎么写？</li></ul> <blockquote><p>可以先安装其他全局依赖，再使用yarn安装，记得命令写在一个RUN指令里, 下面是部分示例</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code>RUN yarn config <span class="token keyword">set</span> registry https://registry.npm.taobao.org \
    <span class="token operator">&amp;&amp;</span> yarn global <span class="token function">install</span> bower \
    <span class="token operator">&amp;&amp;</span> bower i --allow-root \
    yarn
</code></pre></div><h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp" target="_blank" rel="noopener noreferrer">https://nodejs.org/en/docs/guides/nodejs-docker-webapp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/nodejs/docker-node/blob/master/README.md#image-variants" target="_blank" rel="noopener noreferrer">https://github.com/nodejs/docker-node/blob/master/README.md#image-variants<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/waylybaye/HyperApp-Guide/blob/master/zh/centos-upgrade-docker.md" target="_blank" rel="noopener noreferrer">https://github.com/waylybaye/HyperApp-Guide/blob/master/zh/centos-upgrade-docker.md<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/v1.11/engine/reference/commandline/cli/" target="_blank" rel="noopener noreferrer">Docker命令查询<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="注"><a href="#注" aria-hidden="true" class="header-anchor">#</a> 注</h2> <p>本文最早发布在掘金，后迁移至<a href="https://github.com/levy9527/blog/issues/3" target="_blank" rel="noopener noreferrer">github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/FEMessage/blog/edit/master/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.md" target="_blank" rel="noopener noreferrer">帮助我们完善此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/docs/soft-skill/the-pyramid-priceple-using-in-github-pr.html" class="prev">
          金字塔原理在Github PR中的运用
        </a></span> <span class="next"><a href="/blog/docs/tutorial/best-pratices-to-publish-vue-component-via-npm.html">
          📦vue组件发布npm最佳实践
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.3b8fd8ff.js" defer></script><script src="/blog/assets/js/2.acf68d8b.js" defer></script><script src="/blog/assets/js/28.35749832.js" defer></script>
  </body>
</html>
