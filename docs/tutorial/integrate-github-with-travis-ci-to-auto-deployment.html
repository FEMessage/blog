<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🚀Github集成Travis CI：自动发布 | FEMessage blog</title>
    <meta name="description" content="things every member should konw">
    <link rel="icon" href="https://avatars3.githubusercontent.com/u/39977793?s=200&amp;v=4">
    
    <link rel="preload" href="/blog/assets/css/0.styles.7a18dcc6.css" as="style"><link rel="preload" href="/blog/assets/js/app.e58d7e76.js" as="script"><link rel="preload" href="/blog/assets/js/2.acf68d8b.js" as="script"><link rel="preload" href="/blog/assets/js/36.3df612db.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b8813f10.js"><link rel="prefetch" href="/blog/assets/js/11.8d493694.js"><link rel="prefetch" href="/blog/assets/js/12.ec5bef1d.js"><link rel="prefetch" href="/blog/assets/js/13.135a16eb.js"><link rel="prefetch" href="/blog/assets/js/14.84a32c94.js"><link rel="prefetch" href="/blog/assets/js/15.d4c929e9.js"><link rel="prefetch" href="/blog/assets/js/16.62e9b8db.js"><link rel="prefetch" href="/blog/assets/js/17.b3257d2b.js"><link rel="prefetch" href="/blog/assets/js/18.6e08b336.js"><link rel="prefetch" href="/blog/assets/js/19.40dfd063.js"><link rel="prefetch" href="/blog/assets/js/20.fa546649.js"><link rel="prefetch" href="/blog/assets/js/21.a87c2187.js"><link rel="prefetch" href="/blog/assets/js/22.f4e546eb.js"><link rel="prefetch" href="/blog/assets/js/23.bcb3f070.js"><link rel="prefetch" href="/blog/assets/js/24.a44154be.js"><link rel="prefetch" href="/blog/assets/js/25.02d2f3e0.js"><link rel="prefetch" href="/blog/assets/js/26.4a911dd3.js"><link rel="prefetch" href="/blog/assets/js/27.b477d326.js"><link rel="prefetch" href="/blog/assets/js/28.3882096c.js"><link rel="prefetch" href="/blog/assets/js/29.5dc6799a.js"><link rel="prefetch" href="/blog/assets/js/3.54a4317f.js"><link rel="prefetch" href="/blog/assets/js/30.dd1326dd.js"><link rel="prefetch" href="/blog/assets/js/31.a36c5936.js"><link rel="prefetch" href="/blog/assets/js/32.96606455.js"><link rel="prefetch" href="/blog/assets/js/33.59cd61fd.js"><link rel="prefetch" href="/blog/assets/js/34.1ea92878.js"><link rel="prefetch" href="/blog/assets/js/35.5d4fccb1.js"><link rel="prefetch" href="/blog/assets/js/37.6d412fd9.js"><link rel="prefetch" href="/blog/assets/js/38.26b5fe1c.js"><link rel="prefetch" href="/blog/assets/js/39.63e6dd89.js"><link rel="prefetch" href="/blog/assets/js/4.78dc510e.js"><link rel="prefetch" href="/blog/assets/js/40.57f2736e.js"><link rel="prefetch" href="/blog/assets/js/41.9855ab16.js"><link rel="prefetch" href="/blog/assets/js/5.e191f0f8.js"><link rel="prefetch" href="/blog/assets/js/6.ad10d0b5.js"><link rel="prefetch" href="/blog/assets/js/7.dd64474c.js"><link rel="prefetch" href="/blog/assets/js/8.a962870c.js"><link rel="prefetch" href="/blog/assets/js/9.4d8e258e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.7a18dcc6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">FEMessage blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/FEMessage/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/FEMessage/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/coding/basic-knowledge.html" class="sidebar-link">前端基础</a></li><li><a href="/blog/docs/coding/before-coding.html" class="sidebar-link">编程修养</a></li><li><a href="/blog/docs/coding/clean-code-tips.html" class="sidebar-link">编码技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程故事</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/coding-story/achieve-commitment-and-deliver-available-software.html" class="sidebar-link">履行承诺，交付可用的功能</a></li><li><a href="/blog/docs/coding-story/how-can-we-fix-200-bugs-in-a-week.html" class="sidebar-link">一周消灭200个bug</a></li><li><a href="/blog/docs/coding-story/just-do-it.html" class="sidebar-link">执行力</a></li><li><a href="/blog/docs/coding-story/practice-collective-ownership.html" class="sidebar-link">编程接力</a></li><li><a href="/blog/docs/coding-story/teamwork.html" class="sidebar-link">团队协作</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件研发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-1-the-workflow.html" class="sidebar-link">组件研发指南（一）：研发流程</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-2-hosting-in-private-registry.html" class="sidebar-link">组件研发指南（二）：私服托管</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-3-the-open-source-guide.html" class="sidebar-link">组件研发指南（三）：开源协作</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-4-thinking-improvement.html" class="sidebar-link">组件研发指南（四）：思维提升</a></li><li><a href="/blog/docs/component-development/how-to-develop-open-source-vue-component-part-5-some-tips-may-help.html" class="sidebar-link">组件研发指南（五）：基础拾遗</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GIT指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/git/git-best-pratices.html" class="sidebar-link">GIT最佳实践</a></li><li><a href="/blog/docs/git/git-common-commands.html" class="sidebar-link">GIT常用命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>软技能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/soft-skill/rules-of-thumb-and-nuggets-of-wisdom.html" class="sidebar-link">经验法则与至理名言</a></li><li><a href="/blog/docs/soft-skill/search-tips.html" class="sidebar-link">搜索技巧</a></li><li><a href="/blog/docs/soft-skill/the-pyramid-priceple-using-in-github-pr.html" class="sidebar-link">金字塔原理在Github PR中的运用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docs/tutorial/a-guide-for-chinese-frontend-developer-dockerizing-your-nodejs-app.html" class="sidebar-link">🐳从零开始Docker化Node.js应用</a></li><li><a href="/blog/docs/tutorial/best-pratices-to-publish-vue-component-via-npm.html" class="sidebar-link">📦vue组件发布npm最佳实践</a></li><li><a href="/blog/docs/tutorial/capture-and-rewrite-https-request.html" class="sidebar-link">🕸捕获与改写HTTPS请求</a></li><li><a href="/blog/docs/tutorial/decode-base64-in-utf8.html" class="sidebar-link">🔍解码base64的utf-8字符串</a></li><li><a href="/blog/docs/tutorial/how-to-write-a-github-app.html" class="sidebar-link">🤖如何写一个Github App</a></li><li><a href="/blog/docs/tutorial/integrate-github-with-netlify-to-preview-changes.html" class="sidebar-link">⚡️Github集成Netlify：快速预览PR</a></li><li><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html" class="active sidebar-link">🚀Github集成Travis CI：自动发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html#免费购买travis-ci应用" class="sidebar-link">免费购买Travis CI应用</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html#选择关联仓库" class="sidebar-link">选择关联仓库</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html#编写ci文件" class="sidebar-link">编写CI文件</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html#相关操作" class="sidebar-link">相关操作</a></li><li class="sidebar-sub-header"><a href="/blog/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.html#注" class="sidebar-link">注</a></li></ul></li><li><a href="/blog/docs/tutorial/reveal-the-secret-of-a-powerful-tool-to-develop-vue-single-file-compoent.html" class="sidebar-link">🔨揭秘vue-sfc-cli：组件研发利器</a></li><li><a href="/blog/docs/tutorial/setup-an-automated-github-workflow.html" class="sidebar-link">🌪自动化的Github Workflow</a></li><li><a href="/blog/docs/tutorial/test-driven-development-by-jest.html" class="sidebar-link">✅使用jest进行测试驱动开发</a></li><li><a href="/blog/docs/tutorial/use-free-https-service.html" class="sidebar-link">🔒免费开启HTTPS</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="🚀github集成travis-ci：自动发布"><a href="#🚀github集成travis-ci：自动发布" aria-hidden="true" class="header-anchor">#</a> 🚀Github集成Travis CI：自动发布</h1> <h1 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h1> <p>已经有阮一峰老师的<a href="http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html" target="_blank" rel="noopener noreferrer">持续集成服务 Travis CI 教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，为什么还要写这篇文章？</p> <p>原因有二：</p> <ol><li>文章内容有些过时</li> <li>文章覆盖度不够，有些实践细节没写出来</li></ol> <p>由于以上原因，纵然可以笔者很快在Github集成Travis CI并成功构建，但在发布时却踩了一些坑，折腾一波才终于发布成功。故写下此文，旨在补充更多的细节，帮助他人少走弯路。</p> <h1 id="正文"><a href="#正文" aria-hidden="true" class="header-anchor">#</a> 正文</h1> <h2 id="免费购买travis-ci应用"><a href="#免费购买travis-ci应用" aria-hidden="true" class="header-anchor">#</a> 免费购买Travis CI应用</h2> <p>点击 <a href="https://github.com/marketplace/travis-ci" target="_blank" rel="noopener noreferrer">https://github.com/marketplace/travis-ci<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，登录后免费购买(开源项目集成Travis CI不收费)。</p> <h2 id="选择关联仓库"><a href="#选择关联仓库" aria-hidden="true" class="header-anchor">#</a> 选择关联仓库</h2> <p>选择个人或组织名下需要关联Travis CI的Github仓库。</p> <p>已经设置过的，想进行修改，可以在Github的 Personal settings-&gt; Applications 中进入。<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc6dojqhj306b0al3yr.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc6oifi8j31jc0qmwi8.jpg" alt="image.png"></p> <p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc6vjxb5j31180hk763.jpg" alt=""></p> <h2 id="编写ci文件"><a href="#编写ci文件" aria-hidden="true" class="header-anchor">#</a> 编写CI文件</h2> <p>在项目根目录下新建 <code>.travis.yml</code> 文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> .travis.yml
</code></pre></div><h3 id="发布到github-pages"><a href="#发布到github-pages" aria-hidden="true" class="header-anchor">#</a> 发布到github pages</h3> <p>下面展示一个可以发布到gh-pages的例子，可以稍做修改，复制粘贴使用。</p> <p>该示例包含了：</p> <ul><li>指定node.js版本</li> <li>使用yarn进行安装依赖及构建</li> <li>对安装需要的依赖进行了缓存</li> <li>设置了两个不含敏感信息的环境变量</li> <li>设置了一个含有敏感信息的环境变量</li> <li>把构建生成的文件部署至github pages</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js
<span class="token key atrule">node_js</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> lts/*
<span class="token key atrule">env</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> API_SERVER=https<span class="token punctuation">:</span>//easy<span class="token punctuation">-</span>mock.com/mock/5c1b3895fe5907404e654045/femessage<span class="token punctuation">-</span>mock PUBLIC_PATH=http<span class="token punctuation">:</span>//levy.work/nuxt<span class="token punctuation">-</span>element<span class="token punctuation">-</span>dashboard/
<span class="token comment"># 默认是yarn, 如果有yarn.lock的话</span>
<span class="token key atrule">install</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> yarn
<span class="token comment"># 默认是 yarn test</span>
<span class="token key atrule">script</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> yarn build
<span class="token key atrule">cache</span><span class="token punctuation">:</span> yarn
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">provider</span><span class="token punctuation">:</span> pages
  <span class="token key atrule">skip-cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">keep-history</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">local-dir</span><span class="token punctuation">:</span> dist
  <span class="token key atrule">on</span><span class="token punctuation">:</span>
    <span class="token key atrule">branch</span><span class="token punctuation">:</span> master
  <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $GITHUB_TOKEN
</code></pre></div><p>下面对文件进行说明。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js
<span class="token key atrule">node_js</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> lts/*
</code></pre></div><ul><li>第1行指定了构建环境为node.js</li> <li>第2、3行指定使用node.js最新的LTS版本</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">env</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> API_SERVER=xxx PUBLIC_PATH=xxx
</code></pre></div><p>上面是设置两个环境变量。</p> <p>注意，一次构建中传多个环境变量，必须写在同一行，使用空格分开。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">env</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> API_SERVER=xxx 
<span class="token punctuation">-</span> PUBLIC_PATH=xxx
</code></pre></div><p>如果写成上面的形式，则会变成两个构建，每一个构建中只有一个环境变量。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">install</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> yarn
<span class="token key atrule">script</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> yarn build
<span class="token key atrule">cache</span><span class="token punctuation">:</span> yarn
</code></pre></div><p>上面指定使用yarn进行安装依赖，安装好后执行 <code>yarn build</code> 命令; 为yarn的依赖加速安装，开启了缓存。</p> <p>下面是最关键的部署配置。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">provider</span><span class="token punctuation">:</span> pages
  <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $GITHUB_TOKEN
  <span class="token key atrule">skip-cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">keep-history</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">local-dir</span><span class="token punctuation">:</span> dist
  <span class="token key atrule">on</span><span class="token punctuation">:</span>
    <span class="token key atrule">branch</span><span class="token punctuation">:</span> master
</code></pre></div><ul><li>第2行指定部署到Github Pages，即仓库的 <code>gh-pages</code> 分支，请确保仓库的pages分支是 <code>gh-pages</code> , <a href="#b637c71e">相关操作可以看这里</a></li> <li>第3行指定保留构建后的文件</li> <li>第4行指定每次部署会新增一个提交记录再推送，而不是使用 <code>git push --force</code></li> <li>第5行指定构建后要部署的目录</li> <li>第6、7行指定 <code>master</code> 分支有提交行为时，将触发构建后部署</li> <li>第8行是部署需要用到的<code>github-token</code>,其中<code>$GITHUB_TOKEN</code>是变量，它可以在Travis CI个人仓库的setting页里设置，<a href="#74ae38aa">相关操作可以看这里</a></li></ul> <h3 id="发布到npm"><a href="#发布到npm" aria-hidden="true" class="header-anchor">#</a> 发布到npm</h3> <p>再给出把node.js模块发布到npm的例子</p> <p>主要是 <code>deploy</code> 这里有所不同</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">provider</span><span class="token punctuation">:</span> npm
  <span class="token key atrule">email</span><span class="token punctuation">:</span> &lt;your_email<span class="token punctuation">&gt;</span>
  <span class="token comment"># api_key: travis encrypt NPM_TOKEN --add deploy.api_key --com</span>
  <span class="token key atrule">on</span><span class="token punctuation">:</span>
    <span class="token key atrule">branch</span><span class="token punctuation">:</span> master
  <span class="token key atrule">skip-cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>api_key指的的npm的token，可以登录npm后，在个人中心生成<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc7fic6sj31i00j4tbu.jpg" alt=""></p> <p>因为不能泄露，所以要通过travis ci的命令行工具进行加密，执行以下命令</p> <div class="language- extra-class"><pre class="language-text"><code>travis encrypt NPM_TOKEN --add deploy.api_key --com
</code></pre></div><h3 id="复杂例子"><a href="#复杂例子" aria-hidden="true" class="header-anchor">#</a> 复杂例子</h3> <p>下面是一个复杂的例子，也是实际用到的配置，主要是</p> <ul><li>master分支才会触发构建</li> <li>执行script命令前先读取shell中的环境变量，并生成<code>.env</code>文件</li> <li>构建成功后
<ul><li>把模块发布到npm</li> <li>把文档发布到gh-pages</li></ul></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">branches</span><span class="token punctuation">:</span>
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master
<span class="token key atrule">language</span><span class="token punctuation">:</span> node_js
<span class="token key atrule">node_js</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> lts/*
<span class="token key atrule">git</span><span class="token punctuation">:</span>
  <span class="token key atrule">depth</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">install</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> yarn <span class="token punctuation">-</span><span class="token punctuation">-</span>frozen<span class="token punctuation">-</span>lockfile
<span class="token key atrule">before_script</span><span class="token punctuation">:</span> echo OSS_KEY=$OSS_KEY\\nOSS_SECRET=$OSS_SECRET\\nOSS_BUCKET=$=OSS_BUCKET\\nOSS_REGION=$OSS_REGION <span class="token punctuation">&gt;</span> .env
<span class="token key atrule">script</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> yarn build
<span class="token key atrule">cache</span><span class="token punctuation">:</span> yarn
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">provider</span><span class="token punctuation">:</span> pages
  <span class="token key atrule">local-dir</span><span class="token punctuation">:</span> docs
  <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $GITHUB_TOKEN
  <span class="token key atrule">skip-cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">keep-history</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token punctuation">-</span> <span class="token key atrule">provider</span><span class="token punctuation">:</span> npm
  <span class="token key atrule">email</span><span class="token punctuation">:</span> levy9527@qq.com
  <span class="token key atrule">api_key</span><span class="token punctuation">:</span> $NPM_TOKEN
  <span class="token key atrule">skip-cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h2 id="相关操作"><a href="#相关操作" aria-hidden="true" class="header-anchor">#</a> 相关操作</h2> <h3 id="使用travis命令行工具加密"><a href="#使用travis命令行工具加密" aria-hidden="true" class="header-anchor">#</a> 使用travis命令行工具加密</h3> <p>加密要用到travis命令行工具，如果是在travis ci web界面设置环境变量，则可直接跳过。</p> <p>下面给出mac环境下操作需要注意的点</p> <p>1.安装命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>brew <span class="token function">install</span> travis
</code></pre></div><p>否则很可能会出现<a href="https://github.com/travis-ci/travis.rb/issues/190" target="_blank" rel="noopener noreferrer">问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>2.确保在 https://travis-ci.org/ sign in with github</p> <p>3.然后在项目根目录里，执行命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>travis login —auto
</code></pre></div><p>4.修改git设置</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> .git/config
</code></pre></div><p>确保</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>travis<span class="token punctuation">]</span>
  slug <span class="token operator">=</span> 是你在travis关联的仓库
</code></pre></div><p>5.添加加密环境变量</p> <div class="language-bash extra-class"><pre class="language-bash"><code>travis encrypt github-token<span class="token operator">=</span>xxx --add deploy.github-token --com
</code></pre></div><p>因为笔者登录的travis ci域名是 <a href="https://travis-ci.com" target="_blank" rel="noopener noreferrer">https://travis-ci.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，所以要带参数 <code>--com</code> ， 默认是 <a href="https://travis-ci.org" target="_blank" rel="noopener noreferrer">https://travis-ci.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="通过环境变量设置github-token"><a href="#通过环境变量设置github-token" aria-hidden="true" class="header-anchor">#</a> 通过环境变量设置GITHUB_TOKEN</h3> <p>首先为Travis CI新建一个token<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc7wji7dj306b0al3yr.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc9aokfuj3072054jrh.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc86igirj307a05ot8u.jpg" alt=""></p> <p>点击生成新token<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6mc9l127yj30qp02a74f.jpg" alt=""></p> <p>设置权限</p> <p><img src="https://camo.githubusercontent.com/ebf7a6eb9efa27c6e67aa6f4a619600d552177f8/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323730303335313531302d35363965386361642d656363342d343230612d613763302d6439346366383761363633322e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d353136266e616d653d696d6167652e706e67266f726967696e4865696768743d31303332266f726967696e57696474683d313232382673697a653d353938333234267374617475733d646f6e652677696474683d36313423616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363237266f726967696e4865696768743d31303332266f726967696e57696474683d31323238267374617475733d646f6e652677696474683d373436" alt="image.png"><br>复制生成的token。(记得先不要刷新或离开当前页面，否则token就看不见了，只能重新生成)</p> <p>登录Travis CI, 进入要集成的项目设置页。</p> <p><img src="https://camo.githubusercontent.com/f85e1e3768101a72602e4196cd116ce8e3ef7400/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323730303630363736332d38303235396132322d653330652d343734652d616535302d6333313935383336376631662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d333438266e616d653d696d6167652e706e67266f726967696e4865696768743d363936266f726967696e57696474683d323534302673697a653d343334323739267374617475733d646f6e652677696474683d3132373023616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323034266f726967696e4865696768743d363936266f726967696e57696474683d32353430267374617475733d646f6e652677696474683d373436" alt="image.png"></p> <p>添加环境变量<code>GITHUB_TOKEN</code></p> <p>注意，这里的环境变量是通过bash设置、并在.yml里读取的，所以变量名是大写加下划线形式，这是bash的最佳实践，千万别写成<code>github-token</code></p> <p><img src="https://camo.githubusercontent.com/79fc1975b05507406c16199e74ff88dcc5135b86/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323730303639323934352d64633864633631362d363832392d346332622d616661652d3931353062613030313339382e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d333030266e616d653d696d6167652e706e67266f726967696e4865696768743d363030266f726967696e57696474683d313930362673697a653d323236383538267374617475733d646f6e652677696474683d39353323616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323335266f726967696e4865696768743d363030266f726967696e57696474683d31393036267374617475733d646f6e652677696474683d373436" alt="image.png"></p> <h3 id="github-pages"><a href="#github-pages" aria-hidden="true" class="header-anchor">#</a> GitHub Pages</h3> <p>查看<code>gh-pages</code>分支的部署情况</p> <p>进入仓库 Settings -&gt; Options</p> <p><img src="https://camo.githubusercontent.com/04cd0a6cfed07d7ffbdc94dd5b6d2581e4b5e308/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323639393539363430322d30383230346638612d356633362d343938362d616262372d6530623365616137616236652e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d313030266e616d653d696d6167652e706e67266f726967696e4865696768743d323030266f726967696e57696474683d313630362673697a653d313134343838267374617475733d646f6e652677696474683d38303323616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d3933266f726967696e4865696768743d323030266f726967696e57696474683d31363036267374617475733d646f6e652677696474683d373436" alt="image.png"></p> <p>往下翻看，可以看到效果<br><img src="https://camo.githubusercontent.com/39c0771c595e8532683831f8c5a1a67c43ab5886/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3136303539302f313535323639393633313630352d37623031386334612d396534662d343430352d393432332d3933343566336162313665332e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323434266e616d653d696d6167652e706e67266f726967696e4865696768743d343838266f726967696e57696474683d313338302673697a653d323738373434267374617475733d646f6e652677696474683d36393023616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d323634266f726967696e4865696768743d343838266f726967696e57696474683d31333830267374617475733d646f6e652677696474683d373436" alt="image.png">因为笔者自定义了域名，所以地址不是默认的 <a href="https://xxx.github.io/xxx" target="_blank" rel="noopener noreferrer">https://xxx.github.io/xxx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="注"><a href="#注" aria-hidden="true" class="header-anchor">#</a> 注</h2> <p><a href="https://github.com/levy9527/blog/issues/1" target="_blank" rel="noopener noreferrer">原文地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/FEMessage/blog/edit/master/docs/tutorial/integrate-github-with-travis-ci-to-auto-deployment.md" target="_blank" rel="noopener noreferrer">帮助我们完善此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/docs/tutorial/integrate-github-with-netlify-to-preview-changes.html" class="prev">
          ⚡️Github集成Netlify：快速预览PR
        </a></span> <span class="next"><a href="/blog/docs/tutorial/reveal-the-secret-of-a-powerful-tool-to-develop-vue-single-file-compoent.html">
          🔨揭秘vue-sfc-cli：组件研发利器
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.e58d7e76.js" defer></script><script src="/blog/assets/js/2.acf68d8b.js" defer></script><script src="/blog/assets/js/36.3df612db.js" defer></script>
  </body>
</html>
